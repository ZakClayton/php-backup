<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Php-backup by sebastiansulinski</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Php-backup</h1>
      <h2 class="project-tagline">Simple package for backing up databases, files and directories to Dropbox and Ftp.</h2>
      <a href="https://github.com/sebastiansulinski/php-backup" class="btn">View on GitHub</a>
      <a href="https://github.com/sebastiansulinski/php-backup/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/sebastiansulinski/php-backup/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="php-backup" class="anchor" href="#php-backup" aria-hidden="true"><span class="octicon octicon-link"></span></a>PHP Backup</h1>

<p>A simple package for backing up mysql databases, files and directories to Dropbox and FTP.</p>

<p>This package makes use of</p>

<ul>
<li><a href="https://github.com/backup-manager/backup-manager">backup-manager/backup-manager</a></li>
<li><a href="https://github.com/thephpleague/flysystem">thephpleague/flysystem</a></li>
<li><a href="http://php.net/manual/en/class.ziparchive.php">ZipArchive</a></li>
<li><a href="https://github.com/briannesbitt/Carbon">briannesbitt/Carbon</a></li>
</ul>

<h2>
<a id="usage-examples" class="anchor" href="#usage-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage examples</h2>

<p>You can watch this <a href="https://ssdtutorials.com/courses/dropbox-backup">video tutorial</a> or read below.</p>

<h3>
<a id="backing-up-to-dropbox" class="anchor" href="#backing-up-to-dropbox" aria-hidden="true"><span class="octicon octicon-link"></span></a>Backing up to Dropbox</h3>

<pre><code>require "../vendor/autoload.php";

use SSD\DotEnv\DotEnv;

use SSD\Backup\Backup;
use SSD\Backup\Remotes\Dropbox;
use SSD\Backup\Jobs\Directory;
use SSD\Backup\Jobs\File;
use SSD\Backup\Jobs\MySQLDatabase;

$dotenv = new DotEnv([
    __DIR__ . '/.env'
]);
$dotenv-&gt;load();
$dotenv-&gt;required([
    'DROPBOX_SECRET',
    'DROPBOX_OAUTH',
    'REMOTE_DIR_NAME',
    'DB_HOST',
    'DB_PORT',
    'DB_NAME',
    'DB_USER',
    'DB_PASS'
]);

// working directory
$workingDirectory = __DIR__ . '/tmp';

try {

    $remote = new Dropbox(
        getenv('DROPBOX_OAUTH'),
        getenv('DROPBOX_SECRET')
    );

    $backup = new Backup(
        $remote,
        $workingDirectory
    );

    // directory to which backup should be saved on the remote server
    $backup-&gt;setRemoteDirectory(getenv('REMOTE_DIR_NAME'));

    // keep only 7 backups then overwrite the oldest one
    $backup-&gt;setNumberOfBackups(7);

    // add MySQL database to the backup
    $backup-&gt;addJob(new Job(
        new MySQLDatabase([
            'host' =&gt; getenv('DB_HOST'),
            'name' =&gt; getenv('DB_NAME'),
            'user' =&gt; getenv('DB_USER'),
            'password' =&gt; getenv('DB_PASS')
        ]),
        'database'
    ));

    // add single file to the backup
    $backup-&gt;addJob(new Job(
        new File(
            __DIR__ . '/files/text.txt',
            __DIR__
        ),
        'files'
    ));

    // add the 'files' directory to the backup
    // but exclude the 'css' directory within
    $backup-&gt;addJob(new Job(
        new Directory(
            __DIR__ . '/files',
            __DIR__,
            [
                'files/css'
            ]
        ),
        'files'
    ));

    // run backup
    $backup-&gt;run();

} catch (Exception $e) {

    $file = $workingDirectory . DIRECTORY_SEPARATOR . 'error_log';

    file_put_contents($file, $e-&gt;getMessage() . PHP_EOL, FILE_APPEND | LOCK_EX);

}
</code></pre>

<h3>
<a id="backing-up-to-ftp" class="anchor" href="#backing-up-to-ftp" aria-hidden="true"><span class="octicon octicon-link"></span></a>Backing up to Ftp</h3>

<pre><code>require "../vendor/autoload.php";

use SSD\DotEnv\DotEnv;

use SSD\Backup\Backup;
use SSD\Backup\Remotes\Ftp;
use SSD\Backup\Jobs\Directory;
use SSD\Backup\Jobs\File;
use SSD\Backup\Jobs\MySQLDatabase;

$dotenv = new DotEnv([
    __DIR__ . '/.env'
]);
$dotenv-&gt;load();
$dotenv-&gt;required([
    'FTP_HOST',
    'FTP_USER',
    'FTP_PASS',
    'REMOTE_DIR_NAME',
    'DB_HOST',
    'DB_PORT',
    'DB_NAME',
    'DB_USER',
    'DB_PASS'
]);

// working directory
$workingDirectory = __DIR__ . '/tmp';

try {

    $remote = new Ftp(
        getenv('FTP_HOST'),
        getenv('FTP_USER'),
        getenv('FTP_PASS')
    );

    $backup = new Backup(
        $remote,
        $workingDirectory
    );

    // directory to which backup should be saved on the remote server
    $backup-&gt;setRemoteDirectory(getenv('REMOTE_DIR_NAME'));

    // keep only 7 backups then overwrite the oldest one
    $backup-&gt;setNumberOfBackups(7);

    // add MySQL database to the backup
    $backup-&gt;addJob(new Job(
        new MySQLDatabase([
            'host' =&gt; getenv('DB_HOST'),
            'name' =&gt; getenv('DB_NAME'),
            'user' =&gt; getenv('DB_USER'),
            'password' =&gt; getenv('DB_PASS')
        ]),
        'database'
    ));

    // add single file to the backup
    $backup-&gt;addJob(new Job(
        new File(
            __DIR__ . '/files/text.txt',
            __DIR__
        ),
        'files'
    ));

    // add the entire directory to the backup
    $backup-&gt;addJob(new Job(
        new Directory(
            __DIR__ . '/files/css',
            __DIR__ . '/files'
        ),
        'files'
    ));

    // run backup
    $backup-&gt;run();

} catch (Exception $e) {

    $file = $workingDirectory . DIRECTORY_SEPARATOR . 'error_log';

    file_put_contents($file, $e-&gt;getMessage() . PHP_EOL, FILE_APPEND | LOCK_EX);

}
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/sebastiansulinski/php-backup">Php-backup</a> is maintained by <a href="https://github.com/sebastiansulinski">sebastiansulinski</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
